{% extends 'base.html' %}

{% block content %}
    <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Connect Your Monobank Account</h1>
    
    <p class="text-gray-600 mb-4 text-sm">
        To connect your Monobank account, enter your API token. You can get it from the 
        <a href="https://api.monobank.ua/" target="_blank" class="text-blue-600 hover:underline">Monobank API page</a>.
    </p>

    <p>
        Status: {% if user.monotoken %} Linked {% else %} Not linked {% endif %}
    </p>

    {% if error %}
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p>{{ error }}</p>
        </div>
    {% endif %}

    <form method="post" class="space-y-4">
        {% csrf_token %}
        <div>
            <label for="mono_token" class="block text-sm font-medium text-gray-700">Monobank API Token</label>
            <input 
                type="text" 
                name="mono_token" 
                id="mono_token" 
                required 
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                placeholder="Enter your Monobank token"
            >
        </div>
        <div class="center_div">
            <button type="submit">
                Link Account
            </button>
        </div>
    </form>

    <div class="sa_buttons">
        {% if user.monotoken %}
            <button onclick="unlinkMono()">
                Unlink Account
            </button>
        {% endif %}

        <a href="{% url 'expenses' %}">
            <button>Back to Expenses</button>
        </a>
    </div>
</div>

<script>
    document.querySelector('form').addEventListener('submit', function(e) {
        const tokenInput = document.getElementById('mono_token').value.trim();
        if (tokenInput.length < 10) {
            e.preventDefault();
            alert('Please enter a valid Monobank token.');
        }
    });
</script>

<script>
function unlinkMono() {
    if (confirm('Are you sure you want to unlink monobank?')) {
        window.location.href = `/api/delete-mono-token/`;
    }
}
</script>
{% endblock %}